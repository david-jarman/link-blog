@page "/"
@page "/page/{PageNumber:int}"
@using LinkBlog.Abstractions
@using LinkBlog.Data
@using LinkBlog.Web.Components.Posts
@using Microsoft.Extensions.Options
@attribute [OutputCache(Duration = 60, VaryByRouteValueNames = new[] { "PageNumber" })]

@inject IPostStore PostStore
@inject IOptions<BlogOptions> BlogOptions

<HeadContent>
    <!-- Open Graph tags  -->
    <meta property="og:title" content="@BlogTitle" />
    <meta property="og:type" content="website" />
</HeadContent>

<PageTitle>@BlogTitle</PageTitle>

<div class="page-links-container">
    <nav class="page-links">
        @* <a href="/about" class="page-link">About Me</a> *@
        <a href="/blogroll" class="page-link">Blogroll</a>
        <a href="/archive/2025" class="page-link">2025 Posts</a>
        <a href="/atom/all" class="page-link">RSS</a>
    </nav>
</div>

<PostList Posts="posts" />

@if (CurrentPage > 1 || hasMore)
{
    <nav class="pagination-nav">
        @if (CurrentPage > 1)
        {
            <a href="@NewerPostsUrl" class="pagination-link newer-posts">← Newer Posts</a>
        }
        @if (hasMore)
        {
            <a href="/page/@(CurrentPage + 1)" class="pagination-link older-posts">Older Posts →</a>
        }
    </nav>
}

@code {
    private const string BlogTitle = "David Jarman's Blog";

    [Parameter]
    public int PageNumber { get; set; } = 1;

    private Post[]? posts;
    private bool hasMore;

    private int CurrentPage => PageNumber < 1 ? 1 : PageNumber;

    private string NewerPostsUrl => CurrentPage == 2 ? "/" : $"/page/{CurrentPage - 1}";

    protected override async Task OnInitializedAsync()
    {
        var pageSize = BlogOptions.Value.PostsPerPage;
        var result = await PostStore.GetPostsPagedAsync(CurrentPage, pageSize);
        this.posts = result.Posts;
        this.hasMore = result.HasMore;
    }
}